<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title></title><meta name="description" content="">
    <link rel="preload" href="/blog/assets/style-35f1ccaa.css" as="style"><link rel="stylesheet" href="/blog/assets/style-35f1ccaa.css">
    <link rel="modulepreload" href="/blog/assets/app-5e6e879c.js"><link rel="modulepreload" href="/blog/assets/render.html-f28f56a5.js"><link rel="modulepreload" href="/blog/assets/render.html-136cc72d.js"><link rel="prefetch" href="/blog/assets/index.html-cf3d36dd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-75a7baaa.js" as="script"><link rel="prefetch" href="/blog/assets/wasm.html-e0d1a29b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0e6bd63b.js" as="script"><link rel="prefetch" href="/blog/assets/gpt.html-441893de.js" as="script"><link rel="prefetch" href="/blog/assets/rust.html-fb5c93f8.js" as="script"><link rel="prefetch" href="/blog/assets/sso.html-40b7c1cc.js" as="script"><link rel="prefetch" href="/blog/assets/webrtc.html-eeaf9dbd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-88bff350.js" as="script"><link rel="prefetch" href="/blog/assets/http.html-dd874a37.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-46a50a54.js" as="script"><link rel="prefetch" href="/blog/assets/safe.html-0957ca87.js" as="script"><link rel="prefetch" href="/blog/assets/binary-search.html-9d3b9691.js" as="script"><link rel="prefetch" href="/blog/assets/bit-operation.html-574d1397.js" as="script"><link rel="prefetch" href="/blog/assets/catalog.html-23ae0bb4.js" as="script"><link rel="prefetch" href="/blog/assets/dp.html-5f27dbc6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-138f5dc6.js" as="script"><link rel="prefetch" href="/blog/assets/other.html-8e893845.js" as="script"><link rel="prefetch" href="/blog/assets/滑动窗口.html-e204f645.js" as="script"><link rel="prefetch" href="/blog/assets/贪心和回溯.html-2a9e5344.js" as="script"><link rel="prefetch" href="/blog/assets/data-structure.html-343a75ad.js" as="script"><link rel="prefetch" href="/blog/assets/cache.html-20ad873e.js" as="script"><link rel="prefetch" href="/blog/assets/cross.html-ab1cf48c.js" as="script"><link rel="prefetch" href="/blog/assets/event-model.html-defc7bc9.js" as="script"><link rel="prefetch" href="/blog/assets/gc.html-563ee104.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d81f7618.js" as="script"><link rel="prefetch" href="/blog/assets/router.html-dfa5452b.js" as="script"><link rel="prefetch" href="/blog/assets/topic-1-渲染流程.html-f94aa2d6.js" as="script"><link rel="prefetch" href="/blog/assets/topic-2-性能优化.html-ef097247.js" as="script"><link rel="prefetch" href="/blog/assets/bfc.html-9a576c35.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5412ce67.js" as="script"><link rel="prefetch" href="/blog/assets/prefix.html-5650758b.js" as="script"><link rel="prefetch" href="/blog/assets/responsive.html-1f054495.js" as="script"><link rel="prefetch" href="/blog/assets/babel.html-7dc82796.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0f6e2682.js" as="script"><link rel="prefetch" href="/blog/assets/other.html-b03be679.js" as="script"><link rel="prefetch" href="/blog/assets/vite_rollup.html-2e8368a9.js" as="script"><link rel="prefetch" href="/blog/assets/webpack.html-bbe76151.js" as="script"><link rel="prefetch" href="/blog/assets/arrayBuffer.html-a7c42b8b.js" as="script"><link rel="prefetch" href="/blog/assets/async.html-60dcec3d.js" as="script"><link rel="prefetch" href="/blog/assets/class.html-8cc55fc9.js" as="script"><link rel="prefetch" href="/blog/assets/function.html-7834c5f1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cee5492d.js" as="script"><link rel="prefetch" href="/blog/assets/iterator_generator.html-84be86fe.js" as="script"><link rel="prefetch" href="/blog/assets/let_const.html-74e24d31.js" as="script"><link rel="prefetch" href="/blog/assets/promise.html-b0522fd8.js" as="script"><link rel="prefetch" href="/blog/assets/set_map.html-c3e3749f.js" as="script"><link rel="prefetch" href="/blog/assets/widget.html-cb9477b9.js" as="script"><link rel="prefetch" href="/blog/assets/algorithm.html-466b7fef.js" as="script"><link rel="prefetch" href="/blog/assets/async-and-event_loop.html-b1397fb3.js" as="script"><link rel="prefetch" href="/blog/assets/data-type.html-0ecbc475.js" as="script"><link rel="prefetch" href="/blog/assets/fp.html-b85b24d3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e52f4c51.js" as="script"><link rel="prefetch" href="/blog/assets/module.html-1810eae3.js" as="script"><link rel="prefetch" href="/blog/assets/prototype.html-464940f2.js" as="script"><link rel="prefetch" href="/blog/assets/scoped.html-37ff1969.js" as="script"><link rel="prefetch" href="/blog/assets/this.html-20a44493.js" as="script"><link rel="prefetch" href="/blog/assets/widget.html-f485dbb5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-10bfc81e.js" as="script"><link rel="prefetch" href="/blog/assets/micro-fe.html-63a8e384.js" as="script"><link rel="prefetch" href="/blog/assets/小程序.html-40407cf6.js" as="script"><link rel="prefetch" href="/blog/assets/fiber.html-a6899419.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-30415461.js" as="script"><link rel="prefetch" href="/blog/assets/core.html-3e0b49bd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-38b068fb.js" as="script"><link rel="prefetch" href="/blog/assets/between_2_and_3.html-ef613832.js" as="script"><link rel="prefetch" href="/blog/assets/computed_and_watch.html-7349a438.js" as="script"><link rel="prefetch" href="/blog/assets/core.html-66bd6281.js" as="script"><link rel="prefetch" href="/blog/assets/diff.html-2e35534a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-aa1733f1.js" as="script"><link rel="prefetch" href="/blog/assets/pinia _ vuex.html-08a94569.js" as="script"><link rel="prefetch" href="/blog/assets/pub-sub.html-9c42a081.js" as="script"><link rel="prefetch" href="/blog/assets/mediator.html-cafe0e50.js" as="script"><link rel="prefetch" href="/blog/assets/observer.html-0af728e7.js" as="script"><link rel="prefetch" href="/blog/assets/adapter.html-f5ecc03a.js" as="script"><link rel="prefetch" href="/blog/assets/brideg.html-bed2d6ab.js" as="script"><link rel="prefetch" href="/blog/assets/decorator.html-a55e2f06.js" as="script"><link rel="prefetch" href="/blog/assets/proxy.html-a00887c1.js" as="script"><link rel="prefetch" href="/blog/assets/factory.html-bbd1b412.js" as="script"><link rel="prefetch" href="/blog/assets/single.html-e799ea7a.js" as="script"><link rel="prefetch" href="/blog/assets/quick-sort.html-31061918.js" as="script"><link rel="prefetch" href="/blog/assets/sort.html-d865088d.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3cf864cd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-adf52756.js" as="script"><link rel="prefetch" href="/blog/assets/wasm.html-b313f073.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3e730603.js" as="script"><link rel="prefetch" href="/blog/assets/gpt.html-d6e37fc7.js" as="script"><link rel="prefetch" href="/blog/assets/rust.html-0cec0fb4.js" as="script"><link rel="prefetch" href="/blog/assets/sso.html-612e1d89.js" as="script"><link rel="prefetch" href="/blog/assets/webrtc.html-ecb57a46.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-88465e0a.js" as="script"><link rel="prefetch" href="/blog/assets/http.html-4604b2a2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-460042da.js" as="script"><link rel="prefetch" href="/blog/assets/safe.html-5ec33b75.js" as="script"><link rel="prefetch" href="/blog/assets/binary-search.html-15da20df.js" as="script"><link rel="prefetch" href="/blog/assets/bit-operation.html-6747bb73.js" as="script"><link rel="prefetch" href="/blog/assets/catalog.html-a20b5187.js" as="script"><link rel="prefetch" href="/blog/assets/dp.html-270e12dd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-435af5d8.js" as="script"><link rel="prefetch" href="/blog/assets/other.html-aeaed0e6.js" as="script"><link rel="prefetch" href="/blog/assets/滑动窗口.html-66cdf5dc.js" as="script"><link rel="prefetch" href="/blog/assets/贪心和回溯.html-b195d988.js" as="script"><link rel="prefetch" href="/blog/assets/data-structure.html-72c36693.js" as="script"><link rel="prefetch" href="/blog/assets/cache.html-48ec8fa5.js" as="script"><link rel="prefetch" href="/blog/assets/cross.html-7484a115.js" as="script"><link rel="prefetch" href="/blog/assets/event-model.html-55be845b.js" as="script"><link rel="prefetch" href="/blog/assets/gc.html-4f5ca7c4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cfd329c1.js" as="script"><link rel="prefetch" href="/blog/assets/router.html-3c7d7a42.js" as="script"><link rel="prefetch" href="/blog/assets/topic-1-渲染流程.html-b775aec1.js" as="script"><link rel="prefetch" href="/blog/assets/topic-2-性能优化.html-9143eae7.js" as="script"><link rel="prefetch" href="/blog/assets/bfc.html-b07c9eb2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e6e3619a.js" as="script"><link rel="prefetch" href="/blog/assets/prefix.html-640ff714.js" as="script"><link rel="prefetch" href="/blog/assets/responsive.html-21ba4283.js" as="script"><link rel="prefetch" href="/blog/assets/babel.html-7735a7b2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9b6caee7.js" as="script"><link rel="prefetch" href="/blog/assets/other.html-5d94333e.js" as="script"><link rel="prefetch" href="/blog/assets/vite_rollup.html-12e37bdc.js" as="script"><link rel="prefetch" href="/blog/assets/webpack.html-078b5e08.js" as="script"><link rel="prefetch" href="/blog/assets/arrayBuffer.html-13790678.js" as="script"><link rel="prefetch" href="/blog/assets/async.html-172ec57d.js" as="script"><link rel="prefetch" href="/blog/assets/class.html-1d2b4c53.js" as="script"><link rel="prefetch" href="/blog/assets/function.html-59ed56b8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-91ee64e0.js" as="script"><link rel="prefetch" href="/blog/assets/iterator_generator.html-515b7652.js" as="script"><link rel="prefetch" href="/blog/assets/let_const.html-4f0f2360.js" as="script"><link rel="prefetch" href="/blog/assets/promise.html-fd371f8c.js" as="script"><link rel="prefetch" href="/blog/assets/set_map.html-5f2555c7.js" as="script"><link rel="prefetch" href="/blog/assets/widget.html-fd738048.js" as="script"><link rel="prefetch" href="/blog/assets/algorithm.html-b3dba719.js" as="script"><link rel="prefetch" href="/blog/assets/async-and-event_loop.html-409fabab.js" as="script"><link rel="prefetch" href="/blog/assets/data-type.html-219c7376.js" as="script"><link rel="prefetch" href="/blog/assets/fp.html-189a2da9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8d2bfa5c.js" as="script"><link rel="prefetch" href="/blog/assets/module.html-7e5fd555.js" as="script"><link rel="prefetch" href="/blog/assets/prototype.html-93977f1c.js" as="script"><link rel="prefetch" href="/blog/assets/scoped.html-6c532f79.js" as="script"><link rel="prefetch" href="/blog/assets/this.html-40ed9b45.js" as="script"><link rel="prefetch" href="/blog/assets/widget.html-83633006.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a892a658.js" as="script"><link rel="prefetch" href="/blog/assets/micro-fe.html-3c3c75dc.js" as="script"><link rel="prefetch" href="/blog/assets/小程序.html-d9f8648c.js" as="script"><link rel="prefetch" href="/blog/assets/fiber.html-2c746c26.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bba4250b.js" as="script"><link rel="prefetch" href="/blog/assets/core.html-1d42920a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e699563b.js" as="script"><link rel="prefetch" href="/blog/assets/between_2_and_3.html-6b98fde3.js" as="script"><link rel="prefetch" href="/blog/assets/computed_and_watch.html-aa073587.js" as="script"><link rel="prefetch" href="/blog/assets/core.html-3c40c05c.js" as="script"><link rel="prefetch" href="/blog/assets/diff.html-bad8cc14.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b735e3ce.js" as="script"><link rel="prefetch" href="/blog/assets/pinia _ vuex.html-18be13b5.js" as="script"><link rel="prefetch" href="/blog/assets/pub-sub.html-5c16b751.js" as="script"><link rel="prefetch" href="/blog/assets/mediator.html-f298d990.js" as="script"><link rel="prefetch" href="/blog/assets/observer.html-047b1995.js" as="script"><link rel="prefetch" href="/blog/assets/adapter.html-b0168cd7.js" as="script"><link rel="prefetch" href="/blog/assets/brideg.html-062607c2.js" as="script"><link rel="prefetch" href="/blog/assets/decorator.html-b37d67e1.js" as="script"><link rel="prefetch" href="/blog/assets/proxy.html-a7ad8f50.js" as="script"><link rel="prefetch" href="/blog/assets/factory.html-4f305d0f.js" as="script"><link rel="prefetch" href="/blog/assets/single.html-95466993.js" as="script"><link rel="prefetch" href="/blog/assets/quick-sort.html-bcf9d249.js" as="script"><link rel="prefetch" href="/blog/assets/sort.html-acec4b67.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-302c7c90.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><!----><!--v-if--></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/front-end/" class="router-link-active" aria-label="front-end"><!--[--><!--]--> front-end <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/CS-other/" class="" aria-label="cs-other"><!--[--><!--]--> cs-other <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/algorithm-and-data" class="" aria-label="algorithm and data structure"><!--[--><!--]--> algorithm and data structure <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/front-end/" class="router-link-active" aria-label="front-end"><!--[--><!--]--> front-end <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/CS-other/" class="" aria-label="cs-other"><!--[--><!--]--> cs-other <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/algorithm-and-data" class="" aria-label="algorithm and data structure"><!--[--><!--]--> algorithm and data structure <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/front-end/browser/render.html#browser-rending-process" class="router-link-active router-link-exact-active sidebar-item" aria-label="browser rending process"><!--[--><!--]--> browser rending process <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/front-end/browser/render.html#parse" class="router-link-active router-link-exact-active sidebar-item" aria-label="Parse"><!--[--><!--]--> Parse <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/front-end/browser/render.html#style" class="router-link-active router-link-exact-active sidebar-item" aria-label="Style"><!--[--><!--]--> Style <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/front-end/browser/render.html#layout" class="router-link-active router-link-exact-active sidebar-item" aria-label="Layout"><!--[--><!--]--> Layout <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/front-end/browser/render.html#paint" class="router-link-active router-link-exact-active sidebar-item" aria-label="Paint"><!--[--><!--]--> Paint <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/front-end/browser/render.html#compositing" class="router-link-active router-link-exact-active sidebar-item" aria-label="Compositing"><!--[--><!--]--> Compositing <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/front-end/browser/render.html#repaint-reflow" class="router-link-active router-link-exact-active sidebar-item" aria-label="repaint &amp; reflow"><!--[--><!--]--> repaint &amp; reflow <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/front-end/browser/render.html#什么是重排重绘" class="router-link-active router-link-exact-active sidebar-item" aria-label="什么是重排重绘"><!--[--><!--]--> 什么是重排重绘 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/front-end/browser/render.html#引起重排-重绘的常见操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="引起重排/重绘的常见操作"><!--[--><!--]--> 引起重排/重绘的常见操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/front-end/browser/render.html#解决方案" class="router-link-active router-link-exact-active sidebar-item" aria-label="解决方案"><!--[--><!--]--> 解决方案 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/front-end/browser/render.html#为什么操作dom-慢" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么操作dom 慢"><!--[--><!--]--> 为什么操作dom 慢 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h2 id="browser-rending-process" tabindex="-1"><a class="header-anchor" href="#browser-rending-process" aria-hidden="true">#</a> browser rending process</h2><p>当浏览器进程获取到 HTML 的第一个字节开始，会通知渲染进程开始解析 HTML，将 HTML 转换成 DOM 树，并进入渲染流程。一般所有的浏览器都会经过五大步骤，分别是：</p><ol><li>PARSE：解析 HTML，构建 DOM 树。</li><li>STYLE：为每个节点计算最终的有效样式。</li><li>LAYOUT：为每个节点计算位置和大小等布局信息。</li><li>PAINT：绘制不同的盒子，为了避免不必要的重绘，将会分成多个层进行处理。</li><li>COMPOSITE &amp; RENDER：将上述不同的层合成为一张位图，发送给 GPU，渲染到屏幕上。</li></ol><h3 id="parse" tabindex="-1"><a class="header-anchor" href="#parse" aria-hidden="true">#</a> Parse</h3><h4 id="解析-html-构建-dom-tree" tabindex="-1"><a class="header-anchor" href="#解析-html-构建-dom-tree" aria-hidden="true">#</a> 解析 HTML 构建 DOM tree</h4><ol><li>Conversion(转换): 浏览器从网络或磁盘读取 html 文件原始字节,根据指定文件编码(如 UTF-7)将字节转换为字符</li><li>Tokenizing(分词解析): 浏览器根据 HTML 规范将字符串转换为不同的 token (标记)（如 html, body）</li><li>Lexing(语法分析): token 将被转换为对象，这些node 对象包含了 HTML 语法的各种信息，如属性、属性值、文本等</li><li>DOM construction(DOM构建): 将上一步产生的节点对象链接在一起，构成一个树状结构(DOM tree)</li></ol><h4 id="预扫描加载器" tabindex="-1"><a class="header-anchor" href="#预扫描加载器" aria-hidden="true">#</a> 预扫描加载器</h4><p>在主线程构建 DOM tree 时，预加载扫描器将解析可用的内容并请求资源, 如 CSS、JS、web 字体，以此来减少加载带来的阻塞</p><h4 id="javascript-可能阻塞解析" tabindex="-1"><a class="header-anchor" href="#javascript-可能阻塞解析" aria-hidden="true">#</a> Javascript 可能阻塞解析</h4><p>在 HTML 解析器发现 script 标签时，会暂停解析，转而下载、解析和执行 js (因为js可能会改变 dom 结构)<br> 为此可使用<code>defer</code>或<code>async</code>属性，或将script标签放在 body 标签结束前</p><h4 id="css-阻塞" tabindex="-1"><a class="header-anchor" href="#css-阻塞" aria-hidden="true">#</a> css 阻塞？</h4><p>CSSOM 和 DOM 是并行构建的，构建 CSSOM 不会阻塞 DOM 的构建。但 CSSOM 会阻塞 JS 的执行，因为 JS 可能会操作样式信息。虽然 CSSOM 不会阻塞 DOM 的构建，但在进入下一阶段之前，必须等待 CSSOM 构建完成。这也是通常所说的 CSSOM 会阻塞渲染。</p><h3 id="style" tabindex="-1"><a class="header-anchor" href="#style" aria-hidden="true">#</a> Style</h3><p>css 引擎处理样式过程分为三个阶段:</p><ol><li>收集、划分和索引所有样式表中存在的样式规则. CSS 引擎会从 Style 标签、css文件及浏览器代理样式中收集所有样式规则，并为这些规则建立索引，以方便后续的高效查询</li><li>访问每个元素并找到适用于该元素的给规则. css 引擎遍历 dom 节点，进行选择器匹配， 并为匹配的节点执行样式设置</li><li>结合层叠规则和其他信息为节点生成最终的计算样式，这些样式的值可以通过 window.getComputedStyle() 获取</li></ol><p>这个附加了计算样式的 dom tree， 就是 cssom(css object model)</p><h3 id="layout" tabindex="-1"><a class="header-anchor" href="#layout" aria-hidden="true">#</a> Layout</h3><p>有了 DOM 树和 DOM 树中元素的计算样式后，浏览器会根据这些信息合并成一个 layout 树，收集所有可见的 DOM 节点，以及每个节点的所有样式信息。</p><p>Layout 树和 DOM 树不一定是一一对应的，为了构建 Layout 树，浏览器主要完成了下列工作：</p><ol><li>从 DOM 树的根节点开始遍历每个可见节点 <ul><li>某些不可见节点（例如 script、head、meta 等），它们不会体现在渲染输出中，会被忽略。</li><li>某些通过设置 display 为 none 隐藏的节点，在渲染树中也会被忽略。</li><li>为伪元素创建 LayoutObject。</li><li>为行内元素创建匿名包含块对应的 LayoutObject。</li></ul></li><li>对于每个可见节点，为其找到适配的 CSSOM 规则并应用它们。</li><li>产出可见节点，包含其内容和计算的样式。</li></ol><h4 id="布局计算" tabindex="-1"><a class="header-anchor" href="#布局计算" aria-hidden="true">#</a> 布局计算</h4><p>浏览器的布局计算工作包含以下内容：</p><ol><li>根据 CSS 盒模型及视觉格式化模型，计算每个元素的各种生成盒的大小和位置。</li><li>计算块级元素、行内元素、浮动元素、各种定位元素的大小和位置。</li><li>计算文字，滚动区域的大小和位置。</li><li>LayoutObject 有两种类型： <ul><li>传统的 LayoutObject 节点，会把布局运算的结果重新写回布局树中。</li><li>LayoutNG（Chrome 76 开始启用） 节点的输出是不可变的，会保存在 NGLayoutResult 中，这是一个树状的结构，相比之前的 LayoutObject，少了很大回溯计算，提高了性能。</li></ul></li></ol><h3 id="paint" tabindex="-1"><a class="header-anchor" href="#paint" aria-hidden="true">#</a> Paint</h3><p>LayoutObject 树转换成供合成器使用的高效渲染格式</p><h4 id="构建-paintlayer-renderlayer-树" tabindex="-1"><a class="header-anchor" href="#构建-paintlayer-renderlayer-树" aria-hidden="true">#</a> 构建 PaintLayer（RenderLayer） 树</h4><p>构建完成的 LayoutObject 树还不能拿去显示，因为它不包含绘制的顺序（z-index）。同时，也为了考虑一些复杂的情况，如 3D 变换、页面滚动等，浏览器会对上一步的节点进行分层处理。这个处理过程被称为建立层叠上下文。</p><p>将页面分层，可以让一个图层独立于其他的图层进行变换和光栅化处理。</p><h3 id="compositing" tabindex="-1"><a class="header-anchor" href="#compositing" aria-hidden="true">#</a> Compositing</h3><p>将 layer 进行分块 光栅化， 传个gpu 进行渲染</p><h4 id="tiling-rater" tabindex="-1"><a class="header-anchor" href="#tiling-rater" aria-hidden="true">#</a> tiling &amp; rater</h4><ol><li>tiling：将 layer 分成 tiles（图块）。 因为有的 layer 可能很大（如整个文档的滚动根节点），对整层的光栅化操作代价昂贵，且 layer 中有的部分是不可见的，会造成不必要的浪费。</li><li>tiles 是光栅化的基本单元。光栅化操作是通过光栅线程池处理的。离视口更近的 tiles 具有更高的优先级，将优先处理。</li><li>一个 layer 实际上会生成多种分辨率的 tiles。</li><li>raster 同样也会处理页面引用的图片资源，display items 中的 paint ops 引用了这些压缩数据，raster 会调用合适的解码器来解压这些数据。</li><li>raster 会通过 Skia 来进行 OpenGL 调用，光栅化数据。</li><li>渲染进程是运行在沙箱中的，不能直接进行系统调用。paint ops 通过 IPC（MOJO）传递给 GPU 进程，GPU 进程会执行真实的 OpenGL（为了保证性能，在 Windows 上转为 DirectX）调用。</li><li>光栅化的位图结果保存在 GPU 内存中，通常作为 OpenGL 材质对象保存。</li><li>双缓冲机制：主线程随时会有 commit 到来，当前的光栅化行为在 pending tree（LayerImpl）上进行，一旦光栅化操作完成，将 pending tree 变为 active tree，后续的 draw 操作在 active tree 上进行。</li></ol><blockquote><p>https://febook.hzfe.org/awesome-interview/book2/browser-render-mechanism https://developer.mozilla.org/zh-CN/docs/Web/Performance/How_browsers_work https://segmentfault.com/a/1190000023609412</p></blockquote><h2 id="repaint-reflow" tabindex="-1"><a class="header-anchor" href="#repaint-reflow" aria-hidden="true">#</a> repaint &amp; reflow</h2><h3 id="什么是重排重绘" tabindex="-1"><a class="header-anchor" href="#什么是重排重绘" aria-hidden="true">#</a> 什么是重排重绘</h3><p>浏览器渲染由获取资源到绘制好图形， 会经历几个阶段: parseHtml -&gt; layout -&gt; paint -&gt; composite</p><ul><li>Parse HTML：相关引擎分别解析文档和样式表以及脚本，生成 DOM 和 CSSOM ，最终合成为 Render 树。</li><li>Layout：浏览器通过 Render 树中的信息，以递归的形式计算出每个节点的尺寸大小和在页面中的具体位置。</li><li>Paint：浏览器将 Render 树中的节点转换成在屏幕上绘制实际像素的指令，这个过程发生在多个图层上。</li><li>Composite：浏览器将所有层按照一定顺序合并为一个图层并绘制在屏幕上。</li></ul><p>当dom或cssom 被修改时， 会导致浏览器重复执行 layout paint 步骤，就被成为重绘和重排</p><h3 id="引起重排-重绘的常见操作" tabindex="-1"><a class="header-anchor" href="#引起重排-重绘的常见操作" aria-hidden="true">#</a> 引起重排/重绘的常见操作</h3><p>重绘: 外观变化时， 如color opacity等<br> 重排:</p><ul><li>布局结果或节点内容变化时，如height float position <ul><li>盒子尺寸类型</li><li>定位 (正常流，浮动和决定定位)</li><li>文档树中元素之间的关系变化</li><li>外部信息(视口大小)</li></ul></li><li>获取布局信息时， 如 offsetTop getComputedStyle</li></ul><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案" aria-hidden="true">#</a> 解决方案</h3><ul><li>对 DOM 进行批量写入和读取（通过虚拟 DOM 或者 DocumentFragment 实现）。</li><li>避免对样式频繁操作，了解常用样式属性触发 Layout / Paint / Composite 的机制，合理使用样式。</li><li>合理利用特殊样式属性（如 transform: translateZ(0) 或者 will-change），将渲染层提升为合成层，开启 GPU 加速，提高页面性能。</li><li>使用变量对布局信息（如 clientTop）进行缓存，避免因频繁读取布局信息而触发重排和重绘。</li><li>需要多次重排的元素 positon 为absolute fixed， 脱离文档流，就不回影响其他元素</li><li>display none</li></ul><h3 id="为什么操作dom-慢" tabindex="-1"><a class="header-anchor" href="#为什么操作dom-慢" aria-hidden="true">#</a> 为什么操作dom 慢</h3><p>dom是渲染线程中,js是js引擎线程中，操作涉及两个线程间的通信,性能上有损耗<br> 而且操作dom会触发渲染线程的重绘回流，增加损耗</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-5e6e879c.js" defer></script>
  </body>
</html>
